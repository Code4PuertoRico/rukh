<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[My Octopress Blog]]></title>
  <link href="http://commonwealth-of-puerto-rico.github.io//github/atom.xml" rel="self"/>
  <link href="http://commonwealth-of-puerto-rico.github.io//github/"/>
  <updated>2014-05-30T09:42:00-04:00</updated>
  <id>http://commonwealth-of-puerto-rico.github.io//github/</id>
  <author>
    <name><![CDATA[Your Name]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Deployment-instructions]]></title>
    <link href="http://commonwealth-of-puerto-rico.github.io//github/blog/2014/05/30/deployment-instructions/"/>
    <updated>2014-05-30T09:41:27-04:00</updated>
    <id>http://commonwealth-of-puerto-rico.github.io//github/blog/2014/05/30/deployment-instructions</id>
    <content type="html"><![CDATA[<h1>Deploying</h1>

<blockquote><p>In order to be able to deploy on both Windows and Linux a Tomcat7 deploy was selected. Heroku was used as a test bed.</p></blockquote>

<p>Para hacer el deploy que pueda funcionar en Windows y en Linux se selecionó JRuby/Java/Tomcat7 y como prueba Heroku.</p>

<p>Para hacer el deploy a tomcat primero este tiene que estar ready para un aplicación Rails 4.</p>

<p>Sigua las instruciones en <a href="tomcat_instructions.md" title="Instruciones para Tomcat">Instruciones para Tomcat</a> las cuales sirven para Linux o Windows.</p>

<p>Despues de preparada la maquina para el deploy en la maquina de &lsquo;development&rsquo; corra los comandos para generar el war file.</p>

<p>Translade el war file al file &lt;TOMCAT_HOME>/webapps y corra el tomcat server.</p>

<blockquote><p>Ubuntu: <code>sudo service tomcat7 {stop|start|restart}</code><br/>
Windows: Apache Tomcat>Monitor Tomcat &mdash; General Tab >> Start</p></blockquote>

<p>Esto debe crear y poblar un folder en en webapps con el mismo nombre del warfile.
Esto puede tomar bastante tiempo&hellip;</p>

<h1>War file</h1>

<p>La generación automatica del warfile es usando el gem Warble version 1.4.0 o mas reciente. Pero esta gema tiene ciertos &lsquo;gotchas&rsquo; entre ellos que los file como web.xml que auto genera pueden contener caracteres chatarra al final, por lo tantos deben ser incluidos manualmente en el projecto para que Warble los cópie en vez de generarlos.</p>

<p>Warble utiliza el file <code>config/warble.rb</code> si existe para su configuración.
Se utilizan las siguientes configuraciones:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.jar_name = "rucpocver#{Time.now.to_i}"
</span><span class='line'>config.excludes = FileList["**/*/*.box"]
</span><span class='line'>config.includes = FileList["Rakefile"]
</span><span class='line'>config.webserver = 'jenkins-ci.winstone'
</span><span class='line'>config.dirs = %w(app config db lib log vendor tmp bin public)
</span><span class='line'>config.bundle_without = []
</span><span class='line'>  #config.features = %w(executable)</span></code></pre></td></tr></table></div></figure>


<p>La primera crea la el nombre del jar con la añadidura del tiempo para evitar conflictos de nombre.<br/>
La segunda remueve cualquier file .box para deploys de torquebox.</p>

<p>Todas las opciones <code>config.webxml</code> son removidas para crearlas en el web.xml ya hecho. Pero si fuera a generar el primero (siempre y cuando chequeé que el file este bien) estas son las opciones:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.webxml.rails.env = 'production'
</span><span class='line'>config.webxml.jruby.compat.version = "2.0"
</span><span class='line'>config.webxml.jruby.min.runtimes = 1
</span><span class='line'>config.webxml.jruby.max.runtimes = 1 </span></code></pre></td></tr></table></div></figure>


<p>Tambien se le puede añadir esta linea al <code>web.xml</code> para darle un nombre a la aplicación en el dashboard de Tomcat
<code>&lt;display-name&gt;Registro de Cuentas por Cobrar&lt;/display-name&gt;</code></p>

<ul>
<li><p>Para crear el war file vaya al directorio del app y corra:<br/>
  <code>warble</code></p></li>
<li><p>Para ver las opciones de warble use <code>warble -T</code></p></li>
</ul>


<h4>Cambios a config/initializers/production.rb y config/application.rb</h4>

<p>-Añadir esto a <code>config/initializers/production.rb</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  # For Warbler
</span><span class='line'>  config.assets.precompile = config.assets.precompile + %w( *.js *.scss *.coffee *.css )
</span><span class='line'>  config.force_ssl = false # Changed for Warbler to false</span></code></pre></td></tr></table></div></figure>


<p>-Añadir esto a <code>config/application.rb</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   # For Warble
</span><span class='line'>    config.assets.enabled = true
</span><span class='line'>    config.assets.initialize_on_precompile = false</span></code></pre></td></tr></table></div></figure>


<p>-Correr <code>rake assets:precompile</code>?</p>

<h1>Trouble shooting</h1>

<ol>
<li><p>Me sale un error de JRuby version&hellip;<img src="NewVersionofJRUBY.png" alt="Error Page for JRuby version" /></p>

<blockquote><p>Este error es probablemente porque un gem llamado jruby-jars que contiene el runtime de jruby esta en la version pasada corra <code>bundle update jruby-jars</code> en la maquina de development y corra warble again.</p></blockquote></li>
<li><p>No corre Tomcat7 en Windows pero funciona en Linux</p>

<blockquote><p>Asegurese que no haya ningún tipo de espacio (&lsquo; &rsquo;) o caracter especial (como #) en el PATH de tomcat. Por ejemplo el sugerido es <code>C:\ApacheTomcat\</code> pero este que funciona el Linux no funciona en windows: &lsquo;ApacheTomcta#7&rsquo; o uno con espacios &lsquo;Apache Tomcat&rsquo;.</p></blockquote></li>
<li><p>Apache Tomcat sube pero la aplicación no corre</p>

<blockquote><p>Creaste la base de datos? Corre <code>jruby -S rake db:migrate RAILS_ENV=production</code> por si acaso.</p></blockquote></li>
<li><p>Algo raro con los war files&hellip;</p>

<blockquote><p>Warble tiene un bug que genera caracteres chatarra al final de files como: <code>web.xml</code> si ese el caso puede eliminar estos caracteres chatarra o mejor y sugerido crear un web.xml file en el directorio en la maquina &lsquo;development&rsquo; para que Warble lo copie y no lo genere.</p></blockquote></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Installation-instructions]]></title>
    <link href="http://commonwealth-of-puerto-rico.github.io//github/blog/2014/05/30/installation-instructions/"/>
    <updated>2014-05-30T09:38:07-04:00</updated>
    <id>http://commonwealth-of-puerto-rico.github.io//github/blog/2014/05/30/installation-instructions</id>
    <content type="html"><![CDATA[<h1>Instalación en Windows (solo Deploy)</h1>

<ol>
<li><a href="">JavaSDK</a></li>
<li><a href="">Java JCE</a></li>
<li><a href="">Tomcat7</a></li>
<li><a href="www.jruby.org">JRuby</a> opcional necesario para las migraciones del db.</li>
<li><a href="">Mariadb</a></li>
</ol>


<p>Hmmm&hellip; Maybe I should create a SaltStack script for this&hellip;</p>

<h1>Instalación en Mac/Linux (para Development)</h1>

<h3>Mac</h3>

<ol>
<li><p><a href="www.rvm.io">RVM</a> (opcional puedes usar homebrew tambien pero RVM es mejor.)
commando: <code>\curl -sSL https://get.rvm.io | bash -s stable</code></p></li>
<li><p><a href="http://brew.sh/">Homebrew</a> comando:
<code>ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"</code></p></li>
<li><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JavaSDK</a> (puede ser la 6 o 7)</p></li>
<li><p>Maria DB: <code>brew install mariadb</code></p></li>
<li><p>Tomcat7: <code>brew install tomcat</code></p></li>
<li><p>JRuby: <code>brew install jruby</code> o mejor <code>rvm install jruby</code></p></li>
</ol>


<h3>Ubuntu</h3>

<p>(comming soon&hellip;)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tomcat-instructions]]></title>
    <link href="http://commonwealth-of-puerto-rico.github.io//github/blog/2014/05/30/tomcat-instructions/"/>
    <updated>2014-05-30T09:31:43-04:00</updated>
    <id>http://commonwealth-of-puerto-rico.github.io//github/blog/2014/05/30/tomcat-instructions</id>
    <content type="html"><![CDATA[<h2>Procedure for a tomcat7 deploy on Windows &amp; Ubuntu</h2>

<h3>Procedimiento para hacer un tomcat7/Rails4 deploy en windows &amp; ubuntu</h3>

<h2>Server:</h2>

<ol>
<li>Download <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK7</a> + <a href="http://tomcat.apache.org/download-70.cgi">tomcat7</a> + <a href="http://www.jruby.org/download">JRuby 1.7.5 or later</a> + <a href="https://downloads.mariadb.org/">Mariadb5.5</a> (or MySQL db)</li>
<li>Bajar el Java Development Kit 7 (mas reciente), tomcat 7, JRuby 1.7.5 o mas reciente (1.7.10 es el mas reciente) y Mariadb 5.5 (o MySQL).</li>
<li>Set <code>JRUBY_OPTS --2.0</code> in the Environmental Variables.</li>
<li>En &lsquo;Control Panel > System > Advanced system settings >> Environmental Variables&hellip;&rsquo; cree una nueva variable <code>JRUBY_OPTS</code> y en su valor ponga <code>--2.0</code>.  Este paso posiblemente no sea necesario con JRuby 9K en adelante.  <img src="environmental_variables.png" title="Environmental Variables" alt="Environmental Variables" /></li>
<li>Download and install Java Cryptographic Extensions (JCE) security files for Java7 and  on your <code>jre7/lib/security</code> folder overwrite the <code>local_policy.jar</code> and <code>US_export_policy.jar</code>. In windows the JRE is located usually in <code>Program Files</code>.<img src="JCE_replace_files.png" title="JCE replace files" alt="Files to Replace" /></li>
<li>Bajar e instalar los JCE (Java Cryptographic Exentsions) para windows del website de Oracle.</li>
<li><strong>NO SPACES</strong> on path for tomcat!!! (no # either) (windows limitation)</li>
<li>El path para la instalacion de tomcat no puede tener espacios ni caracteres especiales.</li>
<li>At the WEB-INF dir do <code>jruby -S rake db:migrate RAILS_ENV=production</code></li>
<li>Corra el commando <code>jruby -S rake db:migrate RAILS_ENV=production</code> para crear la base de datos. El commando debe correr del archivo localizado en <code>&lt;tomcat location&gt;/webapps/&lt;app name&gt;/WEB-INF/</code></li>
<li>Set Tomcat server Heap memory up on the Java tab in windows (Rails 4 requirement) or in <code>/etc/default/tomcat7</code> in Ubuntu Linux.<img src="tomcat_config_windows.png" title="Tomcat Windows Java Config" alt="Tomcat Windows Java Config" /><br/>
Windows requires only the first two options set while Ubuntu requires all three.

<ul>
<li><code>-XX:MaxPermSize=256M</code></li>
<li><code>-XX:PermSize=256M</code></li>
<li><code>-Xmx1024m</code> (possibly can be lower, like 512m)</li>
<li>Located in <code>/etc/default/tomcat7</code> in Ubuntu

<ul>
<li>Cambiar el setting de &lsquo;Heap Memory&rsquo; en el tab de Java en la aplicación para el monitoreo de Tomcat (Windows) o en la configuración de Java. La ultima opción es particularmente importante para Rails 4.1 y Ubuntu. En Windows solo las primeras dos son requisito</li>
</ul>
</li>
</ul>
</li>
<li><p>Set up the admin user for Tomcat. In tomcat/conf/tomcat-users.xml set up the following lines: <img src="tomcatuserssettings.png" title="Tomcat User Settings" alt="Tomcat User Settings" /></p></li>
<li><p>Increase tomcat7 manager&rsquo;s war deploy size if you want to deploy form the admin gui.
 <code>tomcat7/webapps/manager/WEB-INF/web.xml</code>
 Ubuntu: <code>/etc/share/tomcat7-admin/</code></p></li>
<li><p>Run <code>bundle exec rake db:create db:schema:load RAILS_ENV=production</code> (this command can be run from the dev computer if it&rsquo;s in the same network and can connect to the database.)</p></li>
</ol>


<h2>En la maquina de deploy</h2>

<ol>
<li>Utilize Warble 1.4.0.beta1 o mas reciente</li>
<li>Cree un web.xml para que se copie &mdash; no lo deje autogenerar.</li>
<li>Run JRuby Lint to find issues</li>
<li>Flip heroku settins en:</li>
<li>Gemfile</li>
<li>config/application.rb:<br/>
&#8220;`

<h1>For Warble</h1>

<p>config.assets.enabled = true
config.assets.initialize_on_precompile = false
&#8220;`</p></li>
<li>file</li>
</ol>


<p>Notas:</p>

<p>Ubuntu: <code>sudo service tomcat7 {stop|start|restart}</code>
Ubuntu: ROOT is in <code>/var/lib/tomcat7/ROOT</code>
Ubuntu: Logs are in <code>/var/log/tomcat7/</code></p>

<h2>Usando tomcat en Mac con Homebrew</h2>

<p><code>hombrew install tomcat</code></p>

<p>Verifica con
<code>catalina -h</code> &amp; <code>catalina run</code>
To start/stop the server from the command line you use the catalina shell script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ /usr/local/Cellar/tomcat/7.0.53/bin/catalina run
</span><span class='line'>$ /usr/local/Cellar/tomcat/7.0.53/bin/catalina stop</span></code></pre></td></tr></table></div></figure>


<p>¿Donde esta el directorio webapps?
<code>/usr/local/Cellar/tomcat/7.0.53/libexec/webapps/</code></p>
]]></content>
  </entry>
  
</feed>
