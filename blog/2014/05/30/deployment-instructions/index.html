
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Deployment-instructions - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="Deploying In order to be able to deploy on both Windows and Linux a Tomcat7 deploy was selected. Heroku was used as a test bed. Para hacer el deploy &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://commonwealth-of-puerto-rico.github.io//github/blog/2014/05/30/deployment-instructions">
  <link href="/github/favicon.png" rel="icon">
  <link href="/github/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/github/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/github/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/github/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/github/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/github/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:commonwealth-of-puerto-rico.github.io//github" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/github/">Blog</a></li>
  <li><a href="/github/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Deployment-instructions</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-30T09:41:27-04:00" pubdate data-updated="true">May 30<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><h1>Deploying</h1>

<blockquote><p>In order to be able to deploy on both Windows and Linux a Tomcat7 deploy was selected. Heroku was used as a test bed.</p></blockquote>

<p>Para hacer el deploy que pueda funcionar en Windows y en Linux se selecionó JRuby/Java/Tomcat7 y como prueba Heroku.</p>

<p>Para hacer el deploy a tomcat primero este tiene que estar ready para un aplicación Rails 4.</p>

<p>Sigua las instruciones en <a href="tomcat_instructions.md" title="Instruciones para Tomcat">Instruciones para Tomcat</a> las cuales sirven para Linux o Windows.</p>

<p>Despues de preparada la maquina para el deploy en la maquina de &lsquo;development&rsquo; corra los comandos para generar el war file.</p>

<p>Translade el war file al file &lt;TOMCAT_HOME>/webapps y corra el tomcat server.</p>

<blockquote><p>Ubuntu: <code>sudo service tomcat7 {stop|start|restart}</code><br/>
Windows: Apache Tomcat>Monitor Tomcat &mdash; General Tab >> Start</p></blockquote>

<p>Esto debe crear y poblar un folder en en webapps con el mismo nombre del warfile.
Esto puede tomar bastante tiempo&hellip;</p>

<h1>War file</h1>

<p>La generación automatica del warfile es usando el gem Warble version 1.4.0 o mas reciente. Pero esta gema tiene ciertos &lsquo;gotchas&rsquo; entre ellos que los file como web.xml que auto genera pueden contener caracteres chatarra al final, por lo tantos deben ser incluidos manualmente en el projecto para que Warble los cópie en vez de generarlos.</p>

<p>Warble utiliza el file <code>config/warble.rb</code> si existe para su configuración.
Se utilizan las siguientes configuraciones:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.jar_name = "rucpocver#{Time.now.to_i}"
</span><span class='line'>config.excludes = FileList["**/*/*.box"]
</span><span class='line'>config.includes = FileList["Rakefile"]
</span><span class='line'>config.webserver = 'jenkins-ci.winstone'
</span><span class='line'>config.dirs = %w(app config db lib log vendor tmp bin public)
</span><span class='line'>config.bundle_without = []
</span><span class='line'>  #config.features = %w(executable)</span></code></pre></td></tr></table></div></figure>


<p>La primera crea la el nombre del jar con la añadidura del tiempo para evitar conflictos de nombre.<br/>
La segunda remueve cualquier file .box para deploys de torquebox.</p>

<p>Todas las opciones <code>config.webxml</code> son removidas para crearlas en el web.xml ya hecho. Pero si fuera a generar el primero (siempre y cuando chequeé que el file este bien) estas son las opciones:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.webxml.rails.env = 'production'
</span><span class='line'>config.webxml.jruby.compat.version = "2.0"
</span><span class='line'>config.webxml.jruby.min.runtimes = 1
</span><span class='line'>config.webxml.jruby.max.runtimes = 1 </span></code></pre></td></tr></table></div></figure>


<p>Tambien se le puede añadir esta linea al <code>web.xml</code> para darle un nombre a la aplicación en el dashboard de Tomcat
<code>&lt;display-name&gt;Registro de Cuentas por Cobrar&lt;/display-name&gt;</code></p>

<ul>
<li><p>Para crear el war file vaya al directorio del app y corra:<br/>
  <code>warble</code></p></li>
<li><p>Para ver las opciones de warble use <code>warble -T</code></p></li>
</ul>


<h4>Cambios a config/initializers/production.rb y config/application.rb</h4>

<p>-Añadir esto a <code>config/initializers/production.rb</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  # For Warbler
</span><span class='line'>  config.assets.precompile = config.assets.precompile + %w( *.js *.scss *.coffee *.css )
</span><span class='line'>  config.force_ssl = false # Changed for Warbler to false</span></code></pre></td></tr></table></div></figure>


<p>-Añadir esto a <code>config/application.rb</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   # For Warble
</span><span class='line'>    config.assets.enabled = true
</span><span class='line'>    config.assets.initialize_on_precompile = false</span></code></pre></td></tr></table></div></figure>


<p>-Correr <code>rake assets:precompile</code>?</p>

<h1>Trouble shooting</h1>

<ol>
<li><p>Me sale un error de JRuby version&hellip;<img src="NewVersionofJRUBY.png" alt="Error Page for JRuby version" /></p>

<blockquote><p>Este error es probablemente porque un gem llamado jruby-jars que contiene el runtime de jruby esta en la version pasada corra <code>bundle update jruby-jars</code> en la maquina de development y corra warble again.</p></blockquote></li>
<li><p>No corre Tomcat7 en Windows pero funciona en Linux</p>

<blockquote><p>Asegurese que no haya ningún tipo de espacio (&lsquo; &rsquo;) o caracter especial (como #) en el PATH de tomcat. Por ejemplo el sugerido es <code>C:\ApacheTomcat\</code> pero este que funciona el Linux no funciona en windows: &lsquo;ApacheTomcta#7&rsquo; o uno con espacios &lsquo;Apache Tomcat&rsquo;.</p></blockquote></li>
<li><p>Apache Tomcat sube pero la aplicación no corre</p>

<blockquote><p>Creaste la base de datos? Corre <code>jruby -S rake db:migrate RAILS_ENV=production</code> por si acaso.</p></blockquote></li>
<li><p>Algo raro con los war files&hellip;</p>

<blockquote><p>Warble tiene un bug que genera caracteres chatarra al final de files como: <code>web.xml</code> si ese el caso puede eliminar estos caracteres chatarra o mejor y sugerido crear un web.xml file en el directorio en la maquina &lsquo;development&rsquo; para que Warble lo copie y no lo genere.</p></blockquote></li>
</ol>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      








  


<time datetime="2014-05-30T09:41:27-04:00" pubdate data-updated="true">May 30<span>th</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://commonwealth-of-puerto-rico.github.io//github/blog/2014/05/30/deployment-instructions/" data-via="" data-counturl="http://commonwealth-of-puerto-rico.github.io//github/blog/2014/05/30/deployment-instructions/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/github/blog/2014/05/30/installation-instructions/" title="Previous Post: installation-instructions">&laquo; installation-instructions</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/github/blog/2014/05/30/deployment-instructions/">Deployment-instructions</a>
      </li>
    
      <li class="post">
        <a href="/github/blog/2014/05/30/installation-instructions/">Installation-instructions</a>
      </li>
    
      <li class="post">
        <a href="/github/blog/2014/05/30/tomcat-instructions/">Tomcat-instructions</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
